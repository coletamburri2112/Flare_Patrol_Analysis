

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>gbm.data.poshist &mdash; GBM Data Tools 1.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> GBM Data Tools
          

          
            
            <img src="../../../_static/fermi_face.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/index.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">GBM Data Tools API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Change Logs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GBM Data Tools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>gbm.data.poshist</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for gbm.data.poshist</h1><div class="highlight"><pre>
<span></span><span class="c1"># poshist.py: GBM Position History class</span>
<span class="c1">#</span>
<span class="c1">#     Authors: William Cleveland (USRA),</span>
<span class="c1">#              Adam Goldstein (USRA) and</span>
<span class="c1">#              Daniel Kocevski (NASA)</span>
<span class="c1">#</span>
<span class="c1">#     Portions of the code are Copyright 2020 William Cleveland and</span>
<span class="c1">#     Adam Goldstein, Universities Space Research Association</span>
<span class="c1">#     All rights reserved.</span>
<span class="c1">#</span>
<span class="c1">#     Written for the Fermi Gamma-ray Burst Monitor (Fermi-GBM)</span>
<span class="c1">#</span>
<span class="c1">#     This program is free software: you can redistribute it and/or modify</span>
<span class="c1">#     it under the terms of the GNU General Public License as published by</span>
<span class="c1">#     the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">#     (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1">#     This program is distributed in the hope that it will be useful,</span>
<span class="c1">#     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#     GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#     You should have received a copy of the GNU General Public License</span>
<span class="c1">#     along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">astropy.io.fits</span> <span class="k">as</span> <span class="nn">fits</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.lib.recfunctions</span> <span class="kn">import</span> <span class="n">stack_arrays</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>
<span class="kn">from</span> <span class="nn">gbm</span> <span class="kn">import</span> <span class="n">coords</span>
<span class="kn">from</span> <span class="nn">.data</span> <span class="kn">import</span> <span class="n">DataFile</span>
<span class="kn">from</span> <span class="nn">gbm.detectors</span> <span class="kn">import</span> <span class="n">Detector</span>


<div class="viewcode-block" id="PosHist"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist">[docs]</a><span class="k">class</span> <span class="nc">PosHist</span><span class="p">(</span><span class="n">DataFile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for Fermi Position History</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        datatype (str): The datatype of the file</span>
<span class="sd">        detector (str): The GBM detector the file is associated with</span>
<span class="sd">        directory (str): The directory the file is located in</span>
<span class="sd">        filename (str): The filename</span>
<span class="sd">        full_path (str): The full path+filename</span>
<span class="sd">        gti ([(float, float), ...]): A list of time intervals where Fermi is </span>
<span class="sd">                                     outside the SAA</span>
<span class="sd">        headers (dict): The headers for each extension of the poshist file</span>
<span class="sd">        id (str): The GBM file ID</span>
<span class="sd">        is_gbm_file (bool): True if the file is a valid GBM standard file, </span>
<span class="sd">                            False if it is not.</span>
<span class="sd">        is_trigger (bool): True if the file is a GBM trigger file, False if not</span>
<span class="sd">        sun_occulted ([(float, float), ...]): A list of time intervals where the </span>
<span class="sd">                                              sun is occulted by the Earth</span>
<span class="sd">        time_range (float, float): The time range of the poshist        </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PosHist</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_times</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eic_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quat_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alt_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vel_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angvel_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_saa_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gti</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_occulted</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_earth_radius_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geocenter_interp</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_detectors</span> <span class="o">=</span> <span class="p">[</span><span class="n">det</span><span class="o">.</span><span class="n">short_name</span> <span class="k">for</span> <span class="n">det</span> <span class="ow">in</span> <span class="n">Detector</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_headers</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">time_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">gti</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gti</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sun_occulted</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sun_occulted</span>

<div class="viewcode-block" id="PosHist.get_eic"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_eic">[docs]</a>    <span class="k">def</span> <span class="nf">get_eic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the position of Fermi in Earth inertial coordinates</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">                </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: A (3, `n`) array of coordinates at `n` times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_eic_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_quaternions"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_quaternions">[docs]</a>    <span class="k">def</span> <span class="nf">get_quaternions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the Fermi attitude quaternions</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: A (4, `n`) array of quaternions at `n` times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_quat_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_latitude"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_latitude">[docs]</a>    <span class="k">def</span> <span class="nf">get_latitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the position of Fermi in Earth latitude</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: An array of latitudes at the requested times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_longitude"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_longitude">[docs]</a>    <span class="k">def</span> <span class="nf">get_longitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the position of Fermi in Earth East longitude</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">            np.array: An array of East longitudes at the requested times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lon_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_altitude"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_altitude">[docs]</a>    <span class="k">def</span> <span class="nf">get_altitude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the altitude of Fermi in orbit</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            np.array: An array of altitudes at the requested times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alt_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_velocity"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_velocity">[docs]</a>    <span class="k">def</span> <span class="nf">get_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the velocity of Fermi in Earth inertial coordinates</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: A (3, `n`) array of velocity components at `n` times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_vel_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_angular_velocity"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_angular_velocity">[docs]</a>    <span class="k">def</span> <span class="nf">get_angular_velocity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the angular velocity of Fermi</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns        </span>
<span class="sd">            np.array: A (3, `n`) array of angular velocity components at `n` times</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angvel_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_sun_visibility"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_sun_visibility">[docs]</a>    <span class="k">def</span> <span class="nf">get_sun_visibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if the sun is visible (not occulted)</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array(dtype=bool): A boolean array, where True indicates the \</span>
<span class="sd">                                  sun is visible</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sun_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_saa_passage"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_saa_passage">[docs]</a>    <span class="k">def</span> <span class="nf">get_saa_passage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if Fermi is in an SAA passage</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            np.array(dtype=bool): A boolean array, where True indicates Fermi \</span>
<span class="sd">                                  is in SAA</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_saa_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_earth_radius"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_earth_radius">[docs]</a>    <span class="k">def</span> <span class="nf">get_earth_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the angular radius of the Earth as observed by Fermi</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: An array of the apparent angular radius of the Earth</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_earth_radius_interp</span><span class="p">(</span><span class="n">times</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_geocenter_radec"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_geocenter_radec">[docs]</a>    <span class="k">def</span> <span class="nf">get_geocenter_radec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the Equatorial position of the Geocenter as observed by Fermi</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            (np.array, np.array): The RA and Dec of the geocenter</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">eic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_eic</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">coords</span><span class="o">.</span><span class="n">geocenter_in_radec</span><span class="p">(</span><span class="n">eic</span><span class="p">)</span></div>

<div class="viewcode-block" id="PosHist.get_mcilwain_l"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.get_mcilwain_l">[docs]</a>    <span class="k">def</span> <span class="nf">get_mcilwain_l</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the approximate McIlwain L value as determined by the </span>
<span class="sd">        orbital position of Fermi</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            np.array: An array of McIlwain L values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_latitude</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_longitude</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="n">ml</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">calc_mcilwain_l</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ml</span></div>

<div class="viewcode-block" id="PosHist.to_fermi_frame"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.to_fermi_frame">[docs]</a>    <span class="k">def</span> <span class="nf">to_fermi_frame</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert an equatorial position to a position in spacecraft coordinates</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ra (float): The RA of a sky position</span>
<span class="sd">            dec (float): The Dec of a sky position</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>

<span class="sd">        Returns:        </span>
<span class="sd">            (np.array, np.array): The Fermi azimuth, zenith</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">quats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_quaternions</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="n">az</span><span class="p">,</span> <span class="n">zen</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">radec_to_spacecraft</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">quats</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">az</span><span class="p">,</span> <span class="n">zen</span></div>

<div class="viewcode-block" id="PosHist.to_equatorial"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.to_equatorial">[docs]</a>    <span class="k">def</span> <span class="nf">to_equatorial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fermi_az</span><span class="p">,</span> <span class="n">fermi_zen</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert a position in spacecraft coordinates to equatorial coordinates</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            fermi_az (float): The Fermi azimuth of a position</span>
<span class="sd">            fermi_zen (float): The Fermi zenith of a position</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            (np.array, np.array): The RA, Dec of the position</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">quats</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_quaternions</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">spacecraft_to_radec</span><span class="p">(</span><span class="n">fermi_az</span><span class="p">,</span> <span class="n">fermi_zen</span><span class="p">,</span> <span class="n">quats</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span></div>

<div class="viewcode-block" id="PosHist.location_visible"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.location_visible">[docs]</a>    <span class="k">def</span> <span class="nf">location_visible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine if a sky location is visible or occulted by the Earth</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ra (float): The RA of a sky position</span>
<span class="sd">            dec (float): The Dec of a sky position</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>

<span class="sd">        Returns:        </span>
<span class="sd">            np.array(dtype=bool): A boolean array where True indicates the \</span>
<span class="sd">                                  position is visible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">geo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_geocenter_radec</span><span class="p">(</span><span class="n">times</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">haversine</span><span class="p">(</span><span class="n">geo</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">geo</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
        <span class="n">visible</span> <span class="o">=</span> <span class="p">(</span><span class="n">angle</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_earth_radius</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">visible</span></div>

<div class="viewcode-block" id="PosHist.detector_pointing"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.detector_pointing">[docs]</a>    <span class="k">def</span> <span class="nf">detector_pointing</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">det</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieve the pointing of a GBM detector in equatorial coordinates</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            det (str): The GBM detector</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            (np.array, np.array): The RA, Dec of the detector pointing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">det</span> <span class="o">=</span> <span class="n">det</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">det</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detectors</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Illegal detector name&#39;</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">Detector</span><span class="o">.</span><span class="n">from_str</span><span class="p">(</span><span class="n">det</span><span class="p">)</span>
        <span class="n">az</span><span class="p">,</span> <span class="n">zen</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">azimuth</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">zenith</span>
        <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_equatorial</span><span class="p">(</span><span class="n">az</span><span class="p">,</span> <span class="n">zen</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span></div>

<div class="viewcode-block" id="PosHist.detector_angle"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.detector_angle">[docs]</a>    <span class="k">def</span> <span class="nf">detector_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">det</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine the angle between a sky location and a GBM detector</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            ra (float): The RA of a sky position</span>
<span class="sd">            dec (float): The Dec of a sky position</span>
<span class="sd">            det (str): The GBM detector</span>
<span class="sd">            times (float or np.array): Time(s) in MET</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: The angle, in degrees, between the position and \</span>
<span class="sd">                      detector pointing</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">det_ra</span><span class="p">,</span> <span class="n">det_dec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector_pointing</span><span class="p">(</span><span class="n">det</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">haversine</span><span class="p">(</span><span class="n">det_ra</span><span class="p">,</span> <span class="n">det_dec</span><span class="p">,</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">angle</span></div>

<div class="viewcode-block" id="PosHist.open"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.open">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Open and read a position history file</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            filename (str): The filename of the FITS file</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            :class:`PosHist`: The PosHist object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_file_properties</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="c1"># open FITS file</span>
        <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdulist</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hdu</span> <span class="ow">in</span> <span class="n">hdulist</span><span class="p">:</span>
                <span class="n">obj</span><span class="o">.</span><span class="n">_headers</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">hdu</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">hdu</span><span class="o">.</span><span class="n">header</span><span class="p">})</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">hdulist</span><span class="p">[</span><span class="s1">&#39;GLAST POS HIST&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

        <span class="n">times</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;SCLK_UTC&#39;</span><span class="p">]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_times</span> <span class="o">=</span> <span class="n">times</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

        <span class="c1"># set the interpolators</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_set_interpolators</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="PosHist.merge"><a class="viewcode-back" href="../../../api/api-data.html#gbm.data.PosHist.merge">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">poshists</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Merge multiple PosHists into a single PosHist object</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            poshists (list of :class:`PosHist`): List of PosHist objects</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            :class:`PosHist`: The merged PosHist object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># sort by tstart, and remove overlapping times</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">([</span><span class="n">poshist</span><span class="o">.</span><span class="n">time_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">poshist</span> <span class="ow">in</span> <span class="n">poshists</span><span class="p">])</span>
        <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">poshists</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">_times</span><span class="p">]</span>

        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">poshists</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">_data</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">idx</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">poshists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_times</span> <span class="o">&gt;</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poshists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_times</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">poshists</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>

        <span class="c1"># create object with merged data</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_file_properties</span><span class="p">(</span><span class="n">poshists</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">full_path</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_times</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">stack_arrays</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">asrecarray</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">usemask</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_headers</span> <span class="o">=</span> <span class="n">poshists</span><span class="p">[</span><span class="n">idx</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">headers</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_set_interpolators</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="k">def</span> <span class="nf">_set_interpolators</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_times</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>
        <span class="c1"># Earth inertial coordinates interpolator</span>
        <span class="n">eic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;POS_X&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;POS_Y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;POS_Z&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eic_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">eic</span><span class="p">)</span>

        <span class="c1"># quaternions interpolator</span>
        <span class="n">quat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;QSJ_1&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;QSJ_2&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;QSJ_3&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;QSJ_4&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quat_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">quat</span><span class="p">)</span>

        <span class="c1"># Orbital position interpolator</span>
        <span class="c1"># mark TODO: poshist uses the &quot;simple&quot; version of lat/lon calc</span>
        
        <span class="k">if</span> <span class="s1">&#39;SC_LAT&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lat_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;SC_LAT&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lon_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;SC_LON&#39;</span><span class="p">])</span>
            <span class="n">alt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_altitude_from_scpos</span><span class="p">(</span><span class="n">eic</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_lon_from_scpos</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">eic</span><span class="p">,</span> <span class="nb">complex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lat_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lon_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alt_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">alt</span><span class="p">)</span>

        <span class="c1"># Earth radius and geocenter interpolators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_earth_radius_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geo_half_angle</span><span class="p">(</span><span class="n">alt</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geocenter_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span>
                                          <span class="n">coords</span><span class="o">.</span><span class="n">geocenter_in_radec</span><span class="p">(</span><span class="n">eic</span><span class="p">))</span>

        <span class="c1"># Velocity interpolator</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;VEL_X&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;VEL_Y&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;VEL_Z&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vel_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">vel</span><span class="p">)</span>

        <span class="c1"># Angular velocity interpolator</span>
        <span class="n">angvel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;WSJ_1&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;WSJ_2&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;WSJ_3&#39;</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angvel_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">angvel</span><span class="p">)</span>

        <span class="c1"># mark FIXME: the FLAGS=0 and FLAGS=2 never appear in daily poshist</span>
        <span class="c1"># Interpolators for sun visibility and SAA passage</span>
        <span class="n">sun_visible</span> <span class="o">=</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FLAGS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FLAGS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">in_saa</span> <span class="o">=</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FLAGS&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span> <span class="o">|</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;FLAGS&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">sun_visible</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_saa_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">in_saa</span><span class="p">)</span>

        <span class="c1"># set GTI based on SAA passages</span>
        <span class="c1"># also times where sun is occulted</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_gti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_bool_mask</span><span class="p">(</span><span class="n">in_saa</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_occulted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_bool_mask</span><span class="p">(</span><span class="n">sun_visible</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_from_trigdat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">quats</span><span class="p">,</span> <span class="n">scpos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialize the PosHist object with info from a Trigdat object</span>

<span class="sd">        Args:</span>
<span class="sd">            times (np.array): An array of Trigdat bin start times</span>
<span class="sd">            quats (np.array): An array of quaternions from the Trigdat</span>
<span class="sd">            scpos (np.array): An array of EICs from the Trigdat</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">quats</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">quats</span> <span class="o">=</span> <span class="n">quats</span><span class="o">.</span><span class="n">T</span>
        <span class="k">if</span> <span class="n">scpos</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">times</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">scpos</span> <span class="o">=</span> <span class="n">scpos</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># EIC is in km in Trigdat.  We need it in m. </span>
        <span class="n">scpos</span> <span class="o">*=</span> <span class="mf">1000.0</span>

        <span class="c1"># interpolators for EIC and quaternions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_eic_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">scpos</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_quat_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">quats</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>

        <span class="c1"># orbital position interpolators</span>
        <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lat_lon_from_scpos</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">scpos</span><span class="p">,</span> <span class="nb">complex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lat_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lon_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alt_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>

        <span class="c1"># georadius and geocenter interpolators</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_earth_radius_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_geo_half_angle</span><span class="p">(</span><span class="n">alt</span><span class="p">),</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_geocenter_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span>
                                          <span class="n">coords</span><span class="o">.</span><span class="n">geocenter_in_radec</span><span class="p">(</span><span class="n">scpos</span><span class="p">),</span>
                                          <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>

        <span class="c1"># velocity and angular velocity interpolators</span>
        <span class="n">vel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_velocity_from_scpos</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">scpos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_vel_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">vel</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="n">angvel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_angular_velocity_from_quaternion</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">quats</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_angvel_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">angvel</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>

        <span class="c1"># sun visibility</span>
        <span class="n">sun_visible</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sun_visible_from_times</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">sun_visible</span><span class="p">,</span>
                                    <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;extrapolate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sun_occulted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split_bool_mask</span><span class="p">(</span><span class="n">sun_visible</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_split_bool_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Split a boolean mask into segments of contiguous values and apply</span>
<span class="sd">        to array of times</span>

<span class="sd">        Args:</span>
<span class="sd">            mask (np.array(dtype=bool)): The boolean mask</span>
<span class="sd">            times (np.array): The array of times. Must be the same size as mask</span>
<span class="sd">        </span>
<span class="sd">        Returns        </span>
<span class="sd">            [(float, float),...]: A list of time ranges</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># split a boolean mask array into segments based on True/False</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">mask</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="n">mask</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">time_segs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>
        <span class="n">mask_segs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>

        <span class="c1"># retrieve the start and stop times for the &quot;off&quot; intervals</span>
        <span class="n">segs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">numsegs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numsegs</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mask_segs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">segs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">time_segs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">time_segs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c1"># mark FIXME: null if mask is all True or all False</span>
        <span class="c1"># currently assuming that it must be all True</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">segs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">segs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">time_range</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">segs</span>

    <span class="k">def</span> <span class="nf">_altitude_from_scpos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scpos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate altitude from the EIC.</span>
<span class="sd">        Will attempt to do the more complex calculation taking into account</span>
<span class="sd">        the shape of the Earth and the variable rotational velocity of the</span>
<span class="sd">        Earth.  This requires having up-to-date IERS tables.  If local tables</span>
<span class="sd">        are not up-to-date and astropy cannot query for a new table, will </span>
<span class="sd">        default to a simpler approximation (spherical Earth, constant rotational</span>
<span class="sd">        velocity). </span>

<span class="sd">        Args:</span>
<span class="sd">            scpos (np.array): The Earth inertial coordinates</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: The altitudes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">latitude_from_geocentric_coords_complex</span><span class="p">(</span><span class="n">scpos</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Using simple spheroidal Earth approximation&#39;</span><span class="p">)</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">latitude_from_geocentric_coords_simple</span><span class="p">(</span><span class="n">scpos</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">alt</span>

    <span class="k">def</span> <span class="nf">_angular_velocity_from_quaternion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">quats</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate angular velocity from changes in quaternion over time.</span>
<span class="sd">        This is accurate for small rotations over very short times.</span>

<span class="sd">        Args:</span>
<span class="sd">            times (np.array): Times in MET</span>
<span class="sd">                quats (np.array): Quaternions; one for each time</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: The angular velocity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dquat</span> <span class="o">=</span> <span class="n">quats</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">quats</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">prod_quat</span> <span class="o">=</span> <span class="n">dquat</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dt</span><span class="p">)):</span>
            <span class="n">conj_quat</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">quaternion_conj</span><span class="p">(</span><span class="n">quats</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
            <span class="n">prod_quat</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">quaternion_prod</span><span class="p">(</span><span class="n">conj_quat</span><span class="p">,</span> <span class="n">dquat</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
        <span class="n">ang_vel</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">dt</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">prod_quat</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ang_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ang_vel</span><span class="p">,</span> <span class="n">ang_vel</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ang_vel</span>

    <span class="k">def</span> <span class="nf">_velocity_from_scpos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">scpos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate velocity from changes in position over time.</span>

<span class="sd">        Args:</span>
<span class="sd">            times (np.array): Times in MET</span>
<span class="sd">            scpos (np.array): Positions of the spacecraft in Earth inertial </span>
<span class="sd">                              coordinates</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: The velocity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">dpos</span> <span class="o">=</span> <span class="n">scpos</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">scpos</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">velocity</span> <span class="o">=</span> <span class="n">dpos</span> <span class="o">/</span> <span class="n">dt</span>
        <span class="c1"># copy last entry</span>
        <span class="n">velocity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">velocity</span><span class="p">,</span> <span class="n">velocity</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">velocity</span>

    <span class="k">def</span> <span class="nf">_lat_lon_from_scpos</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">scpos</span><span class="p">,</span> <span class="nb">complex</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Convert coordinates of the spacecraft in Earth inertial coordinates</span>
<span class="sd">        to latitude, East longitude, and altitude.</span>

<span class="sd">        Args:</span>
<span class="sd">            times (np.array): Times in MET</span>
<span class="sd">            scpos (np.array): Positions of the spacecraft in Earth inertial </span>
<span class="sd">                              coordinates</span>
<span class="sd">            complex (bool, optional): </span>
<span class="sd">                If True, then uses the non-spherical Earth model and accurate </span>
<span class="sd">                Earth rotation model. Default is False; Earth is a sphere and </span>
<span class="sd">                the Earth rotation model is less accurate. </span>
<span class="sd">                GBM FSW uses the latter option.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            tuple - 3-tuple containing:</span>
<span class="sd">            </span>
<span class="sd">            - *np.array*: latitude</span>
<span class="sd">            - *np.array*: longitude</span>
<span class="sd">            - *np.array*: altitude        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">complex</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">lat</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">latitude_from_geocentric_coords_simple</span><span class="p">(</span><span class="n">scpos</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lat</span><span class="p">,</span> <span class="n">alt</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">latitude_from_geocentric_coords_complex</span><span class="p">(</span><span class="n">scpos</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">longitude_from_geocentric_coords</span><span class="p">(</span><span class="n">scpos</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span>
                                                          <span class="n">ut1</span><span class="o">=</span><span class="nb">complex</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">longitude_from_geocentric_coords</span><span class="p">(</span><span class="n">scpos</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span>
                                                          <span class="n">ut1</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">alt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_geo_half_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">altitudes</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the apparent angular radius of the Earth</span>

<span class="sd">        Args:</span>
<span class="sd">            altitudes (np.array): The altitude of Fermi</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            np.array: The angular radius, in degrees</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mf">6371.0</span> <span class="o">*</span> <span class="mf">1000.0</span>
        <span class="n">half_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rad2deg</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">r</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="n">altitudes</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">half_angle</span>

    <span class="k">def</span> <span class="nf">_sun_visible_from_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">times</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculate the sun visibility mask from the MET</span>

<span class="sd">        Args:</span>
<span class="sd">            times (np.array): The METs</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            np.array(dtype=bool): A boolean mask, where True indicates the sun \</span>
<span class="sd">                                  is visible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">sun</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">get_sun_loc</span><span class="p">(</span><span class="n">times</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">location_visible</span><span class="p">(</span><span class="n">sun</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:],</span> <span class="n">sun</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">times</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright .

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>