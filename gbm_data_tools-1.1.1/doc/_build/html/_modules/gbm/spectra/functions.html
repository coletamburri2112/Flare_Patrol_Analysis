

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>gbm.spectra.functions &mdash; GBM Data Tools 1.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> GBM Data Tools
          

          
            
            <img src="../../../_static/fermi_face.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/index.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api/index.html">GBM Data Tools API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog/index.html">Change Logs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">GBM Data Tools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>gbm.spectra.functions</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for gbm.spectra.functions</h1><div class="highlight"><pre>
<span></span><span class="c1"># functions.py: Various spectral functions and base function class</span>
<span class="c1">#</span>
<span class="c1">#     Authors: William Cleveland (USRA),</span>
<span class="c1">#              Adam Goldstein (USRA) and</span>
<span class="c1">#              Daniel Kocevski (NASA)</span>
<span class="c1">#</span>
<span class="c1">#     Portions of the code are Copyright 2020 William Cleveland and</span>
<span class="c1">#     Adam Goldstein, Universities Space Research Association</span>
<span class="c1">#     All rights reserved.</span>
<span class="c1">#</span>
<span class="c1">#     Written for the Fermi Gamma-ray Burst Monitor (Fermi-GBM)</span>
<span class="c1">#</span>
<span class="c1">#     This program is free software: you can redistribute it and/or modify</span>
<span class="c1">#     it under the terms of the GNU General Public License as published by</span>
<span class="c1">#     the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">#     (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1">#     This program is distributed in the hope that it will be useful,</span>
<span class="c1">#     but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">#     MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">#     GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1">#     You should have received a copy of the GNU General Public License</span>
<span class="c1">#     along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">trapz</span><span class="p">,</span> <span class="n">quad</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">erfc</span>


<div class="viewcode-block" id="Function"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.Function">[docs]</a><span class="k">class</span> <span class="nc">Function</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Abstract class for a 1-D function (e.g. photon model).</span>
<span class="sd">    </span>
<span class="sd">    Sub-classes should be designed with the following requirements:</span>
<span class="sd">    </span>
<span class="sd">    1. Attribute :attr:`nparams` containing the total number of parameters of the</span>
<span class="sd">       function (even parameters that are fixed to a particular value during fitting)</span>
<span class="sd">    2. Method :meth:`eval` that accepts two arguments: an array of parameter values</span>
<span class="sd">       of length :attr:`nparams`; and the array of abscissa values.</span>
<span class="sd">       </span>
<span class="sd">    Sub-classes can optionally add the following for complete and enhanced</span>
<span class="sd">    functionality:</span>
<span class="sd">    </span>
<span class="sd">    1. Attribute :attr:`param_list` that is a list of parameter names in the order</span>
<span class="sd">       they are accepted in the :meth:`eval` method. Each entry in :attr:`param_list` is</span>
<span class="sd">       a tuple of the form (&lt;param_name&gt;, &lt;units&gt;, &lt;description&gt;).  If no units</span>
<span class="sd">       or description are needed, those fields should be a null string &#39;&#39;. If</span>
<span class="sd">       omitted, these will be filled to default values (&#39;param0&#39;, &#39;&#39;, &#39;&#39;), etc.</span>
<span class="sd">    2. Attribute :attr:`default_values` that is a list of default parameter values. </span>
<span class="sd">       This is primarily used for parameter estimation. Default is 1.0 for each</span>
<span class="sd">       parameter</span>
<span class="sd">    3. Attribute :attr:`delta_abs` that is a list of max absolute fitting step for </span>
<span class="sd">       each parameter.  This is used for parameter estimation. Default is 0.1</span>
<span class="sd">       for each parameter.</span>
<span class="sd">    4. Attribute :attr:`delta_rel` that is a list of max relative fitting step for</span>
<span class="sd">       each parameter.  This is used for paramter estimation.  Default is 0.01</span>
<span class="sd">       for each parameter.</span>
<span class="sd">    5. Attribute :attr:`min_values` that is a list of minimum values each parameter</span>
<span class="sd">       can take.  This is used primarily for parameter estimation. Default is</span>
<span class="sd">       -np.inf for each parameter.</span>
<span class="sd">    6) Attribute :attr:`max_values` that is a list of maximum values each parameter</span>
<span class="sd">       can take.  This is used primarily for parameter estimation. Default is</span>
<span class="sd">       np.inf for each parameter.</span>
<span class="sd">    7) Attribute :attr:`free` that is a boolean list indicating if each parameter</span>
<span class="sd">       is allowed to be free for fitting.  False indicates that the parameter</span>
<span class="sd">       will be fixed at its default value. This is used for parameter estimation. </span>
<span class="sd">       Default is True for each parameter.</span>
<span class="sd">    </span>
<span class="sd">    Attributes:</span>
<span class="sd">        default_values (list): The default values for each parameter. </span>
<span class="sd">                               If not defined, each defaults to 1.0</span>
<span class="sd">        delta_abs (list): The maximum absolute fitting step size for each </span>
<span class="sd">                          parameter. If not defined, each default to 0.1</span>
<span class="sd">        delta_rel (list): The maximum relative fitting step size for each </span>
<span class="sd">                          parameter. If not defined, each default to 0.01 </span>
<span class="sd">        free (list): For each parameter, mark True if left free for fitting, </span>
<span class="sd">                     otherwise mark False to fix at the default value.  </span>
<span class="sd">                     If not defined, each default to True. </span>
<span class="sd">        max_values (list): The maximum possible value for each parameter. </span>
<span class="sd">                           If not defined, each default to np.inf</span>
<span class="sd">        min_values (list): The minimum possible value for each parameter. </span>
<span class="sd">                           If not defined, each default to -np.inf</span>
<span class="sd">        name (str): The name of the function</span>
<span class="sd">        nparams (int): Number of parameters in the function.</span>
<span class="sd">        num_components (int): Number of function components. For a normal </span>
<span class="sd">                              function this is one, for a :class:`SuperFunction`, </span>
<span class="sd">                              this can be &gt; 1.</span>
<span class="sd">        param_list (list of 3-tuples): </span>
<span class="sd">            A list of tuples corresponding to the metadata for the </span>
<span class="sd">            parameters: (&lt;param_name&gt;, &lt;units&gt;, &lt;description&gt;) </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nparams&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;param_list&#39;</span><span class="p">,</span> <span class="s1">&#39;default_values&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;delta_abs&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;delta_rel&#39;</span><span class="p">,</span> <span class="s1">&#39;min_values&#39;</span><span class="p">,</span> <span class="s1">&#39;max_values&#39;</span><span class="p">,</span> <span class="s1">&#39;free&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_components</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;nparams&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Function MUST have nparams defined&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;param_list&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;param&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span>
                               <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nparams</span><span class="p">)]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;default_values&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nparams</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;delta_abs&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nparams</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;delta_rel&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nparams</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;min_values&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nparams</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;max_values&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nparams</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;free&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nparams</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">num_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_components</span>

<div class="viewcode-block" id="Function.fit_eval"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.Function.fit_eval">[docs]</a>    <span class="k">def</span> <span class="nf">fit_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the function for a fit.  This differs from the :meth:`eval` </span>
<span class="sd">        because the ``params`` vector should only contain the free fit parameters.</span>
<span class="sd">        The parameters that are set to fixed will automatically be passed to </span>
<span class="sd">        :meth:`eval` at their fixed value.  This enables a fit to be performed </span>
<span class="sd">        withfixed parameters and the associated jacobian and covariance matrices</span>
<span class="sd">        will have the appropriate shape.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            params (iterable):  The parameter vector of the free parameters </span>
<span class="sd">            x (np.array): The values at which to evaluate the function </span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: The function evaluated at the ``x`` points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nparams</span><span class="p">)</span>
        <span class="n">free</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">)</span>
        <span class="n">full_params</span><span class="p">[</span><span class="n">free</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">full_params</span><span class="p">[</span><span class="o">~</span><span class="n">free</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_values</span><span class="p">)[</span><span class="o">~</span><span class="n">free</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">full_params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="Function.eval"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.Function.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the function</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            params (iterable): The parameter vector of the free parameters </span>
<span class="sd">            x (np.array): The values at which to evaluate the function </span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array: The function evaluated at the ``x`` points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;eval() has not been defined&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="Function.integrate"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.Function.integrate">[docs]</a>    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">erange</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                  <span class="n">energy</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Integrate the function over energy to produce a flux.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            params (iterable): The parameter vector, which can be of length </span>
<span class="sd">                               :attr:`nparams` or equal to the length of the </span>
<span class="sd">                               non-fixed (free) parameters.</span>
<span class="sd">            erange (float, float): The energy range over which to integrate</span>
<span class="sd">            num_points (int, optional): The number of points used for </span>
<span class="sd">                                        integration. Default is 1000.</span>
<span class="sd">            log (bool, optional): If True, the integration grid is made in </span>
<span class="sd">                                  log-space, False it is linear. Default is True.</span>
<span class="sd">            energy (bool, optional): If True, perform integration of E*F(E) to </span>
<span class="sd">                                     produce an energy flux, otherwise </span>
<span class="sd">                                     integration is over F(E) to produce a </span>
<span class="sd">                                     photon flux. Default is False.</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            float: The photon or energy flux</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># If given all params, use eval</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">nparams</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval</span>
        <span class="c1"># otherwise, use fit_eval (auto apply fixed params)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">params</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">):</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_eval</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Incorrect number of parameters&#39;</span><span class="p">)</span>

        <span class="c1"># evenly-spaced energies in log space</span>
        <span class="k">if</span> <span class="n">log</span><span class="p">:</span>
            <span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">erange</span><span class="p">),</span> <span class="n">num_points</span><span class="p">)</span>
        <span class="c1"># evenly-spaced energies in linear space</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">energies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">*</span><span class="n">erange</span><span class="p">,</span> <span class="n">num_points</span><span class="p">)</span>

        <span class="n">spectrum</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">energies</span><span class="p">)</span>

        <span class="c1"># photon flux</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">energy</span><span class="p">:</span>
            <span class="n">flux</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">spectrum</span><span class="p">,</span> <span class="n">energies</span><span class="p">)</span>
        <span class="c1"># energy flux</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">flux</span> <span class="o">=</span> <span class="n">trapz</span><span class="p">(</span><span class="n">energies</span> <span class="o">*</span> <span class="n">spectrum</span><span class="p">,</span> <span class="n">energies</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.602e-9</span>

        <span class="k">return</span> <span class="n">flux</span></div>

<div class="viewcode-block" id="Function.parameter_bounds"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.Function.parameter_bounds">[docs]</a>    <span class="k">def</span> <span class="nf">parameter_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apply_state</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The valid parameter bounds</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            apply_state (bool, optional): </span>
<span class="sd">                If True, will only return the bounds for free parameters. </span>
<span class="sd">                Default is True.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            [(float, float), ...]:  The list of bounds [(min, max), ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">bounds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">min_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_values</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">apply_state</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nparams</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">free</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="k">return</span> <span class="n">bounds</span></div>

<div class="viewcode-block" id="Function.add"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.Function.add">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">func1</span><span class="p">,</span> <span class="n">func2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add two Functions. Can also use the ``+`` operator.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            func1 (:class:`Function`): A function </span>
<span class="sd">            func2 (:class:`Function`): A function to add to ``func1``.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            :class:`SuperFunction`:  A function containing the sum of the two functions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_super_function</span><span class="p">(</span><span class="n">func1</span><span class="p">,</span> <span class="n">func2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">func2</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;+&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

<div class="viewcode-block" id="Function.multiply"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.Function.multiply">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">multiply</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">func1</span><span class="p">,</span> <span class="n">func2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Multiply two Functions. Can also use the ``*`` operator.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            func1 (:class:`Function`): A function </span>
<span class="sd">            func2 (:class:`Function`): A function to multiply to ``func1``.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            :class:`SuperFunction`: A function containing the product of the \</span>
<span class="sd">                two functions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_super_function</span><span class="p">(</span><span class="n">func1</span><span class="p">,</span> <span class="n">func2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">func2</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">names</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">obj</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_super_function</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">func1</span><span class="p">,</span> <span class="n">func2</span><span class="p">,</span> <span class="n">operator</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a SuperFunction from two functions (one may itself be</span>
<span class="sd">        a SuperFunction) and an operator.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            func1 (:class:`Function` or :class:`SuperFunction`): A function </span>
<span class="sd">            func2 (:class:`Function` or :class:`SuperFunction`): Another function.</span>
<span class="sd">            operator (&lt;function&gt;): The operator to be performed on the two functions.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            :class:`SuperFunction`: A function containing the product of the \</span>
<span class="sd">                                    two functions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">SuperFunction</span><span class="p">()</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">_num_components</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">_num_components</span> <span class="o">+</span> <span class="n">func2</span><span class="o">.</span><span class="n">_num_components</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">nparams</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">nparams</span> <span class="o">+</span> <span class="n">func2</span><span class="o">.</span><span class="n">nparams</span>

        <span class="c1"># func1 could be a SuperFunction or just a simple Function        </span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func1</span><span class="p">,</span> <span class="n">SuperFunction</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_operator</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">_operator</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_names</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">_sub_names</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_param_list</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">_sub_param_list</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_nparams</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">_sub_nparams</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_functions</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">_sub_functions</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_operator</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">operator</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_param_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">param_list</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_nparams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">nparams</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">eval</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func2</span><span class="p">,</span> <span class="n">SuperFunction</span><span class="p">):</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_operator</span> <span class="o">=</span> <span class="p">[</span><span class="n">operator</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_param_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">param_list</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_nparams</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">nparams</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_functions</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">eval</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_operator</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">_operator</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_names</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">_sub_names</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_param_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">_sub_param_list</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_nparams</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">_sub_nparams</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_functions</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">_sub_functions</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_operator</span> <span class="o">=</span> <span class="p">[</span><span class="n">operator</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_param_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">param_list</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_nparams</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">nparams</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_functions</span> <span class="o">=</span> <span class="p">[</span><span class="n">func1</span><span class="o">.</span><span class="n">eval</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_param_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">param_list</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_nparams</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">nparams</span><span class="p">)</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">_sub_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">func2</span><span class="o">.</span><span class="n">eval</span><span class="p">)</span>

        <span class="c1"># modify param lists to have component names</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">param_list</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">_modify_param_list</span><span class="p">()</span>

        <span class="n">obj</span><span class="o">.</span><span class="n">default_values</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">default_values</span> <span class="o">+</span> <span class="n">func2</span><span class="o">.</span><span class="n">default_values</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">delta_abs</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">delta_abs</span> <span class="o">+</span> <span class="n">func2</span><span class="o">.</span><span class="n">delta_abs</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">delta_rel</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">delta_rel</span> <span class="o">+</span> <span class="n">func2</span><span class="o">.</span><span class="n">delta_rel</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">min_values</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">min_values</span> <span class="o">+</span> <span class="n">func2</span><span class="o">.</span><span class="n">min_values</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">max_values</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">max_values</span> <span class="o">+</span> <span class="n">func2</span><span class="o">.</span><span class="n">max_values</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">free</span> <span class="o">=</span> <span class="n">func1</span><span class="o">.</span><span class="n">free</span> <span class="o">+</span> <span class="n">func2</span><span class="o">.</span><span class="n">free</span>
        <span class="k">return</span> <span class="n">obj</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Function</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Function</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span></div>


<div class="viewcode-block" id="SuperFunction"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.SuperFunction">[docs]</a><span class="k">class</span> <span class="nc">SuperFunction</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Abstract class for a sum or product of functions.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        default_values (list): The default values for each parameter. </span>
<span class="sd">                               If not defined, each defaults to 1.0</span>
<span class="sd">        delta_abs (list): The maximum absolute fitting step size for each </span>
<span class="sd">                          parameter. If not defined, each default to 0.1</span>
<span class="sd">        delta_rel (list): The maximum relative fitting step size for each </span>
<span class="sd">                          parameter. If not defined, each default to 0.01 </span>
<span class="sd">        free (list): For each parameter, mark True if left free for fitting, </span>
<span class="sd">                     otherwise mark False to fix at the default value.  </span>
<span class="sd">                     If not defined, each default to True. </span>
<span class="sd">        max_values (list): The maximum possible value for each parameter. </span>
<span class="sd">                           If not defined, each default to np.inf</span>
<span class="sd">        min_values (list): The minimum possible value for each parameter. </span>
<span class="sd">                           If not defined, each default to -np.inf</span>
<span class="sd">        name (str): The name of the function</span>
<span class="sd">        nparams (int): Number of parameters in the function.</span>
<span class="sd">        num_components (int): Number of function components. For a normal </span>
<span class="sd">                              function this is one, for a :class:`SuperFunction`, </span>
<span class="sd">                              this can be &gt; 1.</span>
<span class="sd">        param_list (list of 3-tuples): </span>
<span class="sd">            A list of tuples corresponding to the metadata for the </span>
<span class="sd">            parameters: (&lt;param_name&gt;, &lt;units&gt;, &lt;description&gt;)  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sub_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sub_nparams</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sub_param_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sub_functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span> <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="SuperFunction.eval"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.SuperFunction.eval">[docs]</a>    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluate the function</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            params (iterable): The parameter vector of the free parameters </span>
<span class="sd">            x (np.array): The values at which to evaluate the function </span>
<span class="sd">            components (bool, optional): If True, evaluate for each component. </span>
<span class="sd">                                         Default is False.</span>
<span class="sd">        </span>
<span class="sd">        Returns:        </span>
<span class="sd">            np.array or list of np.array: </span>
<span class="sd">                The function evaluated at ``x`` points or the function </span>
<span class="sd">                evaluated at ``x`` points for each component.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_nparams</span><span class="p">)))</span>
        <span class="n">evals</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_functions</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">params</span><span class="p">[</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">ind</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">x</span><span class="p">)</span> \
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_functions</span><span class="p">))]</span>
        <span class="k">if</span> <span class="n">components</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">evals</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">the_eval</span> <span class="o">=</span> <span class="n">evals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_components</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">the_eval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_operator</span><span class="p">[</span><span class="n">i</span><span class="p">]((</span><span class="n">the_eval</span><span class="p">,</span> <span class="n">evals</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">the_eval</span></div>

    <span class="k">def</span> <span class="nf">_modify_param_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Modify the parameter list so the parmeter names contain the parent</span>
<span class="sd">        function name.</span>
<span class="sd">        </span>
<span class="sd">        Returns: </span>
<span class="sd">            [(str, str, str), ...]: The modified parameter list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">param_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">plist</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sub_names</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sub_param_list</span><span class="p">):</span>
            <span class="n">new_list</span> <span class="o">=</span> <span class="p">[(</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">plist</span><span class="p">]</span>
            <span class="n">param_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">new_list</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">param_list</span></div>


<span class="c1"># ---- functions</span>
<div class="viewcode-block" id="PowerLaw"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.PowerLaw">[docs]</a><span class="k">class</span> <span class="nc">PowerLaw</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A power law function:</span>
<span class="sd">    </span>
<span class="sd">    :math:`F(E) = A \bigl(\frac{E}{E_{piv}}\bigr)^{\lambda}`,</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`\lambda` is the power-law index</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV.  Nominally fixed to 100 keV.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># The total number of parameters</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="c1"># The list of parameters: (parameter name, units, description)</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot energy&#39;</span><span class="p">)]</span>

    <span class="c1"># -----------------------------------------------------------------------</span>
    <span class="c1"># The following attributes are used for fitting and parameter estimation</span>

    <span class="c1"># The default initialization values for each parameter</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="c1"># The maximum absolute fitting step for each parameter </span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="c1"># The maximum relative fitting step for each parameter </span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="c1"># The minimum value that each parameter can take</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="c1"># The maximum value that each parameter can take   </span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="c1"># If True, then the parameter is a free parameter, otherwise it is fixed  </span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">**</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="Comptonized"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.Comptonized">[docs]</a><span class="k">class</span> <span class="nc">Comptonized</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;An exponentially cut-off power law, parametrized by the</span>
<span class="sd">    peak of the :math:`\nu F_{\nu}` spectrum:</span>
<span class="sd">    </span>
<span class="sd">    :math:`F(E) = A e^{-(2+\lambda)E/E_{peak}} \bigl(\frac{E}{E_{piv}}\bigr)^\lambda`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_{peak}` is the :math:`\nu F_{\nu}` peak in keV</span>
<span class="sd">    * :math:`\lambda` is the power-law index</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV.  Nominally fixed to 100 keV.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epeak&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;SED Peak&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">Epeak</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">logfxn</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">index</span><span class="p">)</span> <span class="o">/</span> <span class="n">Epeak</span> <span class="o">+</span> <span class="n">index</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logfxn</span><span class="p">)</span></div>


<div class="viewcode-block" id="Band"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.Band">[docs]</a><span class="k">class</span> <span class="nc">Band</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;The Band GRB function (a type of smoothly broken power law), parametrized </span>
<span class="sd">    by the peak of the :math:`\nu F_{\nu}` spectrum:</span>
<span class="sd">    </span>
<span class="sd">    :math:`F(E) = A </span>
<span class="sd">    \begin{cases}</span>
<span class="sd">    \bigl(\frac{E}{E_{piv}}\bigr)^\alpha e^{-(2+\alpha)E/E_{peak}}, </span>
<span class="sd">    \text{ if } {E &lt; \frac{(\alpha-\beta)E_{peak}}{2+\alpha}}\\</span>
<span class="sd">    \bigl(\frac{(\alpha-\beta)E_{peak}}{(2+\alpha)E_{piv}}\bigr)^{\alpha-\beta}</span>
<span class="sd">    \exp{\beta-\alpha}\bigl(\frac{E}{E_{piv}}\bigr)^\beta, \text{ otherwise }</span>
<span class="sd">    \end{cases}`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_{peak}` is the :math:`\nu F_{\nu}` peak in keV</span>
<span class="sd">    * :math:`\alpha` is the low-energy power-law index</span>
<span class="sd">    * :math:`\beta` is the high-energy power-law index</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV.  Nominally fixed to 100 keV.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epeak&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;SED Peak&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Low-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;High-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">500.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0001</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">Epeak</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">e0</span> <span class="o">=</span> <span class="n">Epeak</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">ebreak</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">e0</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">ebreak</span><span class="p">)</span>
        <span class="n">logfxn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">logfxn</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">/</span> <span class="n">e0</span>
        <span class="n">dindex</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">-</span> <span class="n">beta</span>
        <span class="n">logfxn</span><span class="p">[</span><span class="o">~</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="n">dindex</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dindex</span> <span class="o">*</span> <span class="n">e0</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">-</span> \
                       <span class="n">dindex</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">idx</span><span class="p">]</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logfxn</span><span class="p">)</span></div>


<div class="viewcode-block" id="BandOld"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.BandOld">[docs]</a><span class="k">class</span> <span class="nc">BandOld</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;The Band GRB function (a type of smoothly broken power law), using the</span>
<span class="sd">    original parameterization: </span>

<span class="sd">    :math:`F(E) = A </span>
<span class="sd">    \begin{cases}</span>
<span class="sd">    \bigl(\frac{E}{E_{piv}}\bigr)^\alpha e^{-\frac{E}{E_0}}, </span>
<span class="sd">    \text{ if } {E &lt; (\alpha-\beta) E_0}\\</span>
<span class="sd">    \bigl(\frac{(\alpha-\beta) E_0}{E_{piv}}\bigr)^{(\alpha-\beta)} </span>
<span class="sd">    e^{(\beta-\alpha)} \bigl(\frac{E}{E_{piv}}\bigr)^\beta, \text{ otherwise }</span>
<span class="sd">    \end{cases}`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_0` is the break energy in keV</span>
<span class="sd">    * :math:`\alpha` is the low-energy power-law index</span>
<span class="sd">    * :math:`\beta` is the high-energy power-law index</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV.  Nominally fixed to 100 keV.</span>
<span class="sd">    </span>
<span class="sd">    References:</span>
<span class="sd">        `Band, D. et al. 1993, ApJ, 413, 281 </span>
<span class="sd">        &lt;http://adsabs.harvard.edu/full/1993ApJ...413..281B&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;E0&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Break Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Low-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;High-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0001</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">e0</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">ebreak</span> <span class="o">=</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="n">e0</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">ebreak</span><span class="p">)</span>
        <span class="n">logfxn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">logfxn</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">/</span> <span class="n">e0</span>
        <span class="n">dindex</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">-</span> <span class="n">beta</span>
        <span class="n">logfxn</span><span class="p">[</span><span class="o">~</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">+</span> <span class="n">dindex</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">dindex</span> <span class="o">*</span> <span class="n">e0</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">-</span> \
                       <span class="n">dindex</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">idx</span><span class="p">]</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">logfxn</span><span class="p">)</span></div>


<div class="viewcode-block" id="BrokenPowerLaw"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.BrokenPowerLaw">[docs]</a><span class="k">class</span> <span class="nc">BrokenPowerLaw</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A sharply-broken power law:</span>
<span class="sd">    </span>
<span class="sd">    :math:`F(E) = A</span>
<span class="sd">    \begin{cases}</span>
<span class="sd">    \bigl(\frac{E}{E_{piv}}\bigr)^\alpha, &amp; \text{ if } {E \leq E_b}\\</span>
<span class="sd">    \bigl(\frac{E_b}{E_{piv}}\bigr)^\alpha \bigl(\frac{E}{E_b}\bigr)^\beta, &amp;</span>
<span class="sd">    \text{ otherwise }</span>
<span class="sd">    \end{cases}`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_{b}` is the break energy in keV</span>
<span class="sd">    * :math:`\alpha` is the low-energy power-law index</span>
<span class="sd">    * :math:`\beta` is the high-energy power-law index</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV.  Nominally fixed to 100 keV.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Eb&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Break Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Low-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;High-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">700.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">ebreak</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">ebreak</span><span class="p">)</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">fxn</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span>
        <span class="n">fxn</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ebreak</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">ebreak</span><span class="p">)</span> <span class="o">**</span> <span class="n">beta</span>
        <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="DoubleBrokenPowerLaw"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.DoubleBrokenPowerLaw">[docs]</a><span class="k">class</span> <span class="nc">DoubleBrokenPowerLaw</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A sharply-broken power law with two breaks:</span>
<span class="sd">    </span>
<span class="sd">    :math:`F(E) = A</span>
<span class="sd">    \begin{cases}</span>
<span class="sd">    \bigl(\frac{E}{E_{piv}}\bigr)^\alpha, </span>
<span class="sd">    \text{ if } {E \leq E_{b1}}\\</span>
<span class="sd">    \bigl(\frac{E_{b1}}{E_{piv}}\bigr)^\alpha \bigl(\frac{E}{E_b}\bigr)^\beta, </span>
<span class="sd">    \text{ if } {E &gt; E_{b1} \text{ and } E \leq E_{b2}}\\</span>
<span class="sd">    \bigl(\frac{E_{b1}}{E_{piv}}\bigr)^\alpha \bigl(\frac{E_{b1}}{E_{b2}}\bigr)^\beta</span>
<span class="sd">    \bigl(\frac{E}{E_{b2}}\bigr)^\gamma, </span>
<span class="sd">    \text{ otherwise}</span>
<span class="sd">    \end{cases}`        </span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_{b1}` is the first break energy in keV</span>
<span class="sd">    * :math:`E_{b2}` is the second break energy in keV</span>
<span class="sd">    * :math:`\alpha` is the low-energy power-law index</span>
<span class="sd">    * :math:`\beta` is the mid-energy power-law index</span>
<span class="sd">    * :math:`\gamma` is the high-energy power-law index</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV.  Nominally fixed to 100 keV.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">7</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Eb1&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Lower Break Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Eb2&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Upper Break Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Low-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;beta&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Mid-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;gamma&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;High-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">ebreak1</span><span class="p">,</span> <span class="n">ebreak2</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gamma</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">mask1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">ebreak1</span><span class="p">)</span>
        <span class="n">fxn</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask1</span><span class="p">]</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span>
        <span class="n">mask2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">ebreak1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">ebreak2</span><span class="p">)</span>
        <span class="n">fxn</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ebreak1</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask2</span><span class="p">]</span> <span class="o">/</span> <span class="n">ebreak1</span><span class="p">)</span> <span class="o">**</span> <span class="n">beta</span>
        <span class="n">mask3</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">ebreak2</span><span class="p">)</span>
        <span class="n">fxn</span><span class="p">[</span><span class="n">mask3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ebreak1</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">**</span> <span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="n">ebreak1</span> <span class="o">/</span> <span class="n">ebreak2</span><span class="p">)</span> <span class="o">**</span> <span class="n">beta</span> <span class="o">*</span> \
                     <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask3</span><span class="p">]</span> <span class="o">/</span> <span class="n">ebreak2</span><span class="p">)</span> <span class="o">**</span> <span class="n">gamma</span>
        <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="SmoothlyBrokenPowerLaw"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.SmoothlyBrokenPowerLaw">[docs]</a><span class="k">class</span> <span class="nc">SmoothlyBrokenPowerLaw</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A smoothly-broken power law with a break scale:</span>
<span class="sd">    </span>
<span class="sd">    :math:`F(E) = A \bigl(\frac{E}{E_{piv}}\bigr)^\beta 10^{(\beta-\beta_{piv})}, \\</span>
<span class="sd">    \text{where }\\</span>
<span class="sd">    \beta = m \Delta \ln\bigl(\frac{e^\alpha + e^{-\alpha}}{2}\bigr); \text{    }</span>
<span class="sd">    \beta_{piv} = m \Delta \ln\bigl(\frac{e^{\alpha_{piv}} + e^{-\alpha_{piv}}}{2}\bigr); \\</span>
<span class="sd">    \alpha = \frac{\log(E/E_b)}{\Delta}; \text{    }</span>
<span class="sd">    \alpha_{piv} = \frac{\log(E_{piv}/E_b)}{\Delta}; \\</span>
<span class="sd">    m = \frac{\lambda_2 - \lambda_1}{2}; \text{    }</span>
<span class="sd">    b = \frac{\lambda_1 + \lambda_2}{2};`</span>
<span class="sd">    </span>
<span class="sd">    and where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_{b}` is the break energy in keV</span>
<span class="sd">    * :math:`\Delta` is the break scale in decades of energy</span>
<span class="sd">    * :math:`\lambda_1` is the low-energy power-law index</span>
<span class="sd">    * :math:`\lambda_2` is the high-energy power-law index</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV.  Nominally fixed to 100 keV.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Eb&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Break Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Delta&#39;</span><span class="p">,</span> <span class="s1">&#39;dex&#39;</span><span class="p">,</span> <span class="s1">&#39;Break Scale&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;lambda1&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Low-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;lambda2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;High-Energy Photon index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">700.0</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">ebreak</span><span class="p">,</span> <span class="n">delta</span><span class="p">,</span> <span class="n">lam1</span><span class="p">,</span> <span class="n">lam2</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">lam2</span> <span class="o">-</span> <span class="n">lam1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">lam1</span> <span class="o">+</span> <span class="n">lam2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">apiv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Epiv</span> <span class="o">/</span> <span class="n">ebreak</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">ebreak</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta</span>
        <span class="n">bpiv</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">apiv</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">apiv</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">m</span> <span class="o">*</span> <span class="n">delta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">**</span> <span class="n">b</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="n">bpiv</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="LogNormal"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.LogNormal">[docs]</a><span class="k">class</span> <span class="nc">LogNormal</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Log-Normal function:</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = \frac{A}{\sqrt{2\pi} \sigma E} </span>
<span class="sd">    e^{-\bigl(\frac{\ln E - \mu}{2\sigma}\bigr)^2}`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`\mu` is the natural log of energy</span>
<span class="sd">    * :math:`\sigma` is the logarithmic standard deviation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;mu&#39;</span><span class="p">,</span> <span class="s1">&#39;Ln(keV)&#39;</span><span class="p">,</span> <span class="s1">&#39;Ln(Energy)&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;sigma&#39;</span><span class="p">,</span> <span class="s1">&#39;Ln(keV)&#39;</span><span class="p">,</span> <span class="s1">&#39;Log Standard Deviation&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sig</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">sig</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="GaussianLog"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.GaussianLog">[docs]</a><span class="k">class</span> <span class="nc">GaussianLog</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gaussian with log_10(E):</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = \frac{A}{\sqrt{2\pi} \sigma} </span>
<span class="sd">    e^{-\bigl(\frac{\log E-\log E_{cen} }{2\sigma}\bigr)^2}, \\</span>
<span class="sd">    \text{ where } \\</span>
<span class="sd">    \sigma = \frac{W}{2.35482}`</span>
<span class="sd">    </span>
<span class="sd">    and where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_{cen}` is the centroid energy in keV</span>
<span class="sd">    * :math:`W` is the :math:`\log_{10}` FWHM at :math:`E_{cen}` in decades</span>
<span class="sd">      of energy</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Ecen&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Centroid&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;dex&#39;</span><span class="p">,</span> <span class="s1">&#39;Log(FWHM)&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">Ecen</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="mf">2.35482</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig</span><span class="p">)</span> <span class="o">*</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Ecen</span><span class="p">))</span> <span class="o">/</span> <span class="n">sig</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="GaussianLogVaryingFWHM"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.GaussianLogVaryingFWHM">[docs]</a><span class="k">class</span> <span class="nc">GaussianLogVaryingFWHM</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gaussian with log_10(E) and linearly-varying FWHM:</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = \frac{A}{\sqrt{2\pi} \sigma} </span>
<span class="sd">    e^{-\bigl(\frac{\log E-\log E_{cen} }{2\sigma}\bigr)^2}, \\</span>
<span class="sd">    \text{ where } \\</span>
<span class="sd">    \sigma = \frac{W + s (\log E - \log E_{cen})}{2.35482}`</span>
<span class="sd">    </span>
<span class="sd">    and where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_{cen}` is the centroid energy in keV</span>
<span class="sd">    * :math:`W` is the :math:`\log_{10}` FWHM at :math:`E_{cen}` in decades</span>
<span class="sd">      of energy</span>
<span class="sd">    * :math:`s` is the slope of :math:`W` with respect to :math:`\log_{10}(E)`</span>
<span class="sd">      in decades per  :math:`\log_{10}(E)`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Ecen&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Centroid&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;dex&#39;</span><span class="p">,</span> <span class="s1">&#39;Log(FWHM)&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;dex/log(keV)&#39;</span><span class="p">,</span> <span class="s1">&#39;Slope of W&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">Ecen</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">+</span> <span class="n">s</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Ecen</span><span class="p">)))</span> <span class="o">/</span> <span class="mf">2.35482</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig</span><span class="p">)</span> <span class="o">*</span> \
              <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Ecen</span><span class="p">))</span> <span class="o">/</span> <span class="n">sig</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="SunyaevTitarchuk"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.SunyaevTitarchuk">[docs]</a><span class="k">class</span> <span class="nc">SunyaevTitarchuk</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Sunyaev-Titarchuk Comptonization spectra:</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = A E^2 e^{-E} \int_0^\infty t^{n-1} </span>
<span class="sd">    e^{-t \bigl(1+\frac{t}{E}\bigr)^{n+3}} \text{d}t, \\</span>
<span class="sd">    \text{ where } \\</span>
<span class="sd">    n = -\frac{3}{2} + \sqrt{\gamma + \frac{9}{4}}; \\</span>
<span class="sd">    \gamma = \frac{511 \pi^2}{G kT \bigl(\tau + \frac{2}{3} \bigr)^2}`</span>
<span class="sd">    </span>
<span class="sd">    and where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`kT` is the electron energy in keV</span>
<span class="sd">    * :math:`\tau` is the optical depth</span>
<span class="sd">    * :math:`G` is the geometry factor, fixed at 3 for a spherical cloud and</span>
<span class="sd">      at 12 for a disk of electrons</span>
<span class="sd">      </span>
<span class="sd">    References:</span>
<span class="sd">        `Sunyaev, R. A. and Titarchuk, L. G. 1980, A&amp;A, 86, 121 </span>
<span class="sd">        &lt;http://adsabs.harvard.edu/full/1980A%26A....86..121S&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;kT&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Electron energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;tau&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Optical depth&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Geometry factor&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">12</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">kT</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="mf">511.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">G</span> <span class="o">*</span> <span class="n">kT</span> <span class="o">*</span> <span class="p">(</span><span class="n">tau</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.5</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">gamma</span> <span class="o">+</span> <span class="mf">2.25</span><span class="p">)</span>

        <span class="n">integrand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">t</span> <span class="o">**</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">t</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mf">3.</span><span class="p">))</span>
        <span class="n">integral</span> <span class="o">=</span> <span class="p">[</span><span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">x1</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x1</span> <span class="ow">in</span> <span class="n">x</span><span class="p">]</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">integral</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="OTTB"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.OTTB">[docs]</a><span class="k">class</span> <span class="nc">OTTB</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Optically-Thin Thermal Bremsstrahlung:</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = A e^{-\frac{E}{kT}} e^{\frac{E_{piv}}{kT}} </span>
<span class="sd">    \biggl(\frac{E_{piv}}{E} \biggr)`    </span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`kT` is the electron energy in keV</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;kT&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Electron energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">kT</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="n">kT</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Epiv</span> <span class="o">/</span> <span class="n">kT</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Epiv</span> <span class="o">/</span> <span class="n">x</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="BlackBody"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.BlackBody">[docs]</a><span class="k">class</span> <span class="nc">BlackBody</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Black Body spectrum:</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = A \frac{E^2}{e^{E/kT}-1}`    </span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`kT` is the temperature in keV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;kT&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">30.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">kT</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">kT</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="YangSoongPulsar"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.YangSoongPulsar">[docs]</a><span class="k">class</span> <span class="nc">YangSoongPulsar</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Yang Soong&#39;s pulsar spectral form</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = A C (1 - E_W G), \\</span>
<span class="sd">    \text{ where} \\</span>
<span class="sd">    C = \begin{cases}</span>
<span class="sd">    \bigl(\frac{E}{E_{piv}}\bigr)^{-\alpha}, &amp; \text{ if } {E \leq E_b} \\</span>
<span class="sd">    \frac{M}{E} e^{-E/E_{piv}}, &amp; \text{ otherwise }</span>
<span class="sd">    \end{cases}; \\</span>
<span class="sd">    M = e^{E_b/E_F} E_b \bigl(\frac{E_b}{E_{piv}}\bigr)^{-\alpha}; \\</span>
<span class="sd">    G = \frac{0.94}{W} e^{-2.76 (\frac{E-E_{cen}}{W})^2};`</span>
<span class="sd">    </span>
<span class="sd">    and where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`\alpha` is the power-law index</span>
<span class="sd">    * :math:`E_b` is the break energy in keV</span>
<span class="sd">    * :math:`E_F` is the e-folding energy in keV</span>
<span class="sd">    * :math:`E_W` is the equivalent line width in keV</span>
<span class="sd">    * :math:`E_{cen}` is the line centroid in keV</span>
<span class="sd">    * :math:`W` is the FWHM of the line, in keV</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV</span>
<span class="sd">    </span>
<span class="sd">    References:</span>
<span class="sd">        `Soong, Y., et al. 1990, ApJ, 348, 641 </span>
<span class="sd">        &lt;http://adsabs.harvard.edu/full/1990ApJ...348..641S&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Eb&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Break Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;EF&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;E-folding Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;EW&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Line Width&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Ecen&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Line Centroid&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Line FWHM&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot Energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">Eb</span><span class="p">,</span> <span class="n">EF</span><span class="p">,</span> <span class="n">EW</span><span class="p">,</span> <span class="n">Ecen</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Eb</span> <span class="o">/</span> <span class="n">EF</span><span class="p">)</span> <span class="o">*</span> <span class="n">Eb</span> <span class="o">*</span> <span class="p">(</span><span class="n">Eb</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">G</span> <span class="o">=</span> <span class="mf">0.94</span> <span class="o">/</span> <span class="n">W</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">2.76</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">Ecen</span><span class="p">)</span> <span class="o">/</span> <span class="n">W</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

        <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">Eb</span><span class="p">)</span>
        <span class="n">C</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">C</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">M</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">/</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">EW</span> <span class="o">*</span> <span class="n">G</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="TanakaPulsar"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.TanakaPulsar">[docs]</a><span class="k">class</span> <span class="nc">TanakaPulsar</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Tanaka&#39;s pulsar model</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = A \frac{C}{C_{piv}} e^{L_{piv}-L}, \\</span>
<span class="sd">    \text{ where} \\</span>
<span class="sd">    C = A E^{-\alpha} e^{-E/kT}; \text{    }</span>
<span class="sd">    C_{piv} E_{piv}^{-\alpha} e^{-E_{piv}/kT}; \\</span>
<span class="sd">    L = \sum_{i=1}^{N_L} \frac{\tau_i (i W)^2 [E/(i E_L)]^2}{(E-i E_L)^2 + (i W)^2}; \\</span>
<span class="sd">    L_{piv} = \sum_{i=1}^{N_L} \frac{\tau_i (i W)^2 [E_{piv}/(i E_L)]^2} </span>
<span class="sd">    {(E_{piv}-i E_L)^2 + (i W)^2}; \\`</span>
<span class="sd">    </span>
<span class="sd">    and where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`\alpha` is the power-law index</span>
<span class="sd">    * :math:`kT` is the temperature in keV</span>
<span class="sd">    * :math:`\tau_1` is the optical depth of the first line</span>
<span class="sd">    * :math:`\tau_2` is the optical depth of the second line</span>
<span class="sd">    * :math:`N_L` is the number of lines; fixed at either 0, 1, or 2</span>
<span class="sd">    * :math:`E_L` is the line centroid in keV of the first line</span>
<span class="sd">    * :math:`W` is the line FWHM in keV</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    References:</span>
<span class="sd">        `Grove, J. E., et al. 1995, ApJ, 438, L25 </span>
<span class="sd">        &lt;https://apps.dtic.mil/docs/citations/ADA461878&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">9</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;kT&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Temperature&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;tau1&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Optical Depth of 1st line&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;tau2&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Optical Depth of 2nd line&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;NL&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Number of lines&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;EL&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;1st Line Centroid&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;1st Line FWHM&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot Energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.00</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span>
                  <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">kT</span><span class="p">,</span> <span class="n">tau1</span><span class="p">,</span> <span class="n">tau2</span><span class="p">,</span> <span class="n">NL</span><span class="p">,</span> <span class="n">EL</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">x</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x</span> <span class="o">/</span> <span class="n">kT</span><span class="p">)</span>
        <span class="n">Cpiv</span> <span class="o">=</span> <span class="n">Epiv</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Epiv</span> <span class="o">/</span> <span class="n">kT</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">NL</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">taus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">tau1</span><span class="p">,</span> <span class="n">tau2</span><span class="p">))</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">L</span> <span class="o">=</span> <span class="p">(</span><span class="n">taus</span> <span class="o">*</span> <span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> \
                 <span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">idx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">EL</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> \
                <span class="p">((</span><span class="n">x</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">idx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">EL</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span>
                            <span class="n">idx</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">,</span> <span class="p">:]</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">L</span><span class="p">[:,</span> <span class="p">:</span><span class="n">NL</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">Lpiv</span> <span class="o">=</span> <span class="p">(</span><span class="n">taus</span> <span class="o">*</span> <span class="p">(</span><span class="n">idx</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">Epiv</span> <span class="o">/</span> <span class="p">(</span><span class="n">idx</span> <span class="o">*</span> <span class="n">EL</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="p">(</span><span class="n">Epiv</span> <span class="o">-</span> <span class="n">idx</span> <span class="o">*</span> <span class="n">EL</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">idx</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">Lpiv</span> <span class="o">=</span> <span class="n">Lpiv</span><span class="p">[:</span><span class="n">NL</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">Lpiv</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">C</span> <span class="o">/</span> <span class="n">Cpiv</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Lpiv</span> <span class="o">-</span> <span class="n">L</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="OTTS"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.OTTS">[docs]</a><span class="k">class</span> <span class="nc">OTTS</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Optically-Thin Thermal Synchrotron:</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = A e^{(E/E_C)^{1/3}}`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_C` is the energy scale in keV</span>
<span class="sd">    </span>
<span class="sd">    References:</span>
<span class="sd">        `Liang, E. P., et al., 1983, ApJ, 271, 776 </span>
<span class="sd">        &lt;http://adsabs.harvard.edu/full/1983ApJ...271..766L&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;EC&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Energy Scale&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">Ec</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">x</span> <span class="o">/</span> <span class="n">Ec</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="GaussLine"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.GaussLine">[docs]</a><span class="k">class</span> <span class="nc">GaussLine</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gaussian Line:</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = A \frac{\text{erfc}(a_l)-\text{erfc}(a_r)}{2(E_r-E_l)}, \\</span>
<span class="sd">    \text{ where } \\</span>
<span class="sd">    a_l = \frac{E_l - E_{cen}}{\sqrt{2}\sigma}; \text{    }</span>
<span class="sd">    a_r = \frac{E_r - E_{cen}}{\sqrt{2}\sigma}; \\</span>
<span class="sd">    \sigma = W/2.35482`</span>
<span class="sd">    </span>
<span class="sd">    and where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`A` is the amplitude in ph/s/cm^2/keV</span>
<span class="sd">    * :math:`E_{cen}` is the centroid energy in keV</span>
<span class="sd">    * :math:`W` is the FHWM in keV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;ph/s/cm^2/keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Amplitude&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Ecen&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Centroid Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;FWHM&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-10</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">A</span><span class="p">,</span> <span class="n">Ecen</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">params</span>

        <span class="c1"># calculate edges; need to add an ending edge</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">dE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">10.0</span> <span class="o">**</span> <span class="n">dE</span><span class="p">])</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">er</span> <span class="o">=</span> <span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="n">sig</span> <span class="o">=</span> <span class="n">W</span> <span class="o">/</span> <span class="mf">2.35482</span>
        <span class="n">al</span> <span class="o">=</span> <span class="p">(</span><span class="n">el</span> <span class="o">-</span> <span class="n">Ecen</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig</span><span class="p">)</span>
        <span class="n">ar</span> <span class="o">=</span> <span class="p">(</span><span class="n">er</span> <span class="o">-</span> <span class="n">Ecen</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig</span><span class="p">)</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="p">(</span><span class="n">erfc</span><span class="p">(</span><span class="n">al</span><span class="p">)</span> <span class="o">-</span> <span class="n">erfc</span><span class="p">(</span><span class="n">ar</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">er</span> <span class="o">-</span> <span class="n">el</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="LowEnergyCutoff"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.LowEnergyCutoff">[docs]</a><span class="k">class</span> <span class="nc">LowEnergyCutoff</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Low-Energy cutoff (Multiplicative Component):</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = \begin{cases}</span>
<span class="sd">    (E/E_{cut})^{E_{cut}/E_F} e^{(E_{cut}-E)/E_F} &amp; \text{ if } {E \leq E_{cut}} \\</span>
<span class="sd">    1 &amp; \text{ otherwise }</span>
<span class="sd">    \end{cases}`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`E_{cut}` is the cutoff energy in keV</span>
<span class="sd">    * :math:`E_{cen}` is the folding energy in keV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Ecut&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Cutoff Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;EF&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Folding Energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">Ecut</span><span class="p">,</span> <span class="n">EF</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">Ecut</span><span class="p">)</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">fxn</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">Ecut</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">Ecut</span> <span class="o">/</span> <span class="n">EF</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="p">(</span><span class="n">Ecut</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">/</span> <span class="n">EF</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="HighEnergyCutoff"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.HighEnergyCutoff">[docs]</a><span class="k">class</span> <span class="nc">HighEnergyCutoff</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A High-Energy cutoff (Multiplicative Component):</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = \begin{cases}    </span>
<span class="sd">    (E/E_{cut})^{E_{cut}/E_F} e^{(E_{cut}-E)/E_F} &amp; \text{ if } {E &gt; E_{cut}} \\</span>
<span class="sd">    1 &amp; \text{ otherwise }</span>
<span class="sd">    \end{cases}`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`E_{cut}` is the cutoff energy in keV</span>
<span class="sd">    * :math:`E_{cen}` is the folding energy in keV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;Ecut&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Cutoff Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;EF&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Folding Energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">Ecut</span><span class="p">,</span> <span class="n">EF</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">Ecut</span><span class="p">)</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">fxn</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">Ecut</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="n">Ecut</span> <span class="o">/</span> <span class="n">EF</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="p">(</span><span class="n">Ecut</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span> <span class="o">/</span> <span class="n">EF</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="PowerLawMult"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.PowerLawMult">[docs]</a><span class="k">class</span> <span class="nc">PowerLawMult</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Power Law (Multiplicative Component):</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = \bigl(\frac{E}{E_{piv}} \bigr)^\lambda`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`\lambda` is the index</span>
<span class="sd">    * :math:`E_{piv}` is the pivot energy in keV</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;lambda&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Index&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Epiv&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Pivot Energy&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">lam</span><span class="p">,</span> <span class="n">Epiv</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">Epiv</span><span class="p">)</span> <span class="o">**</span> <span class="n">lam</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="GaussLineMult"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.GaussLineMult">[docs]</a><span class="k">class</span> <span class="nc">GaussLineMult</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Gaussian Line (Multiplicative Component):</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = e^{I G}, \\</span>
<span class="sd">    \text{ where } \\</span>
<span class="sd">    G = \frac{1}{\sqrt{2\pi}\sigma} e^{-\frac{(E-E_{cen})^2}{2\sigma^2}}; \\</span>
<span class="sd">    \sigma = W/2.35482`</span>
<span class="sd">    </span>
<span class="sd">    and where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`I` is the intensity</span>
<span class="sd">    * :math:`E_{cen}` is the centroid energy in keV</span>
<span class="sd">    * :math:`W` is the FWHM in keV    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Intensity&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Ecen&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Centroid Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;FWHM&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">Ecen</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">W</span> <span class="o">/</span> <span class="mf">2.35482</span>
        <span class="n">G</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="n">sig</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">Ecen</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">I</span> <span class="o">*</span> <span class="n">G</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fxn</span></div>


<div class="viewcode-block" id="LorentzLineMult"><a class="viewcode-back" href="../../../api/api-spectra.html#gbm.spectra.functions.LorentzLineMult">[docs]</a><span class="k">class</span> <span class="nc">LorentzLineMult</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;A Lorentzian Line (Multiplicative Component):</span>
<span class="sd">        </span>
<span class="sd">    :math:`F(E) = e^{\frac{I}{W^2 + (E-E_{cen})^2}}`</span>
<span class="sd">    </span>
<span class="sd">    where </span>
<span class="sd">    </span>
<span class="sd">    * :math:`I` is the intensity</span>
<span class="sd">    * :math:`E_{cen}` is the centroid energy in keV</span>
<span class="sd">    * :math:`W` is the FWHM in keV    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nparams</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">param_list</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;Intensity&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;Ecen&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;Centroid Energy&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span> <span class="s1">&#39;keV&#39;</span><span class="p">,</span> <span class="s1">&#39;FWHM&#39;</span><span class="p">)]</span>
    <span class="n">default_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">]</span>
    <span class="n">delta_abs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">delta_rel</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
    <span class="n">min_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]</span>
    <span class="n">max_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>
    <span class="n">free</span> <span class="o">=</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">I</span><span class="p">,</span> <span class="n">Ecen</span><span class="p">,</span> <span class="n">W</span> <span class="o">=</span> <span class="n">params</span>
        <span class="n">fxn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">I</span> <span class="o">/</span> <span class="p">(</span><span class="n">W</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">Ecen</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fxn</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright .

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>