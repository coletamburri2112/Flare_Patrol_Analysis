

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Simulations &mdash; GBM Data Tools 1.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
        <script defer="defer" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Introduction to the Data Primitives" href="DataPrimitives.html" />
    <link rel="prev" title="GBM Spectral Catalog Files" href="ScatFiles.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> GBM Data Tools
          

          
            
            <img src="../_static/fermi_face.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Jupyter Notebooks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="PhaiiData.html">GBM Science Data: Time History Spectra</a></li>
<li class="toctree-l2"><a class="reference internal" href="TteData.html">TTE Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Responses.html">Detector Response Files</a></li>
<li class="toctree-l2"><a class="reference internal" href="PositionHistory.html">The Position History Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Trigdat.html">Quicklook Trigger Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="Skymaps.html">GBM Localizations and Sky Maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="DataFinders.html">Finding GBM Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="PhaExport.html">Analysis Workflow: Reduction and Export</a></li>
<li class="toctree-l2"><a class="reference internal" href="SpectralFitting.html">Analysis Workflow: Spectral Fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="ScatFiles.html">GBM Spectral Catalog Files</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Simulations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Simulate-PHA-Data">Simulate PHA Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Simulate-TTE-Data">Simulate TTE Data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="DataPrimitives.html">Introduction to the Data Primitives</a></li>
<li class="toctree-l2"><a class="reference internal" href="Plugins.html">Plugin-like Architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="Visualizations.html">Visualizations</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">GBM Data Tools API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog/index.html">Change Logs</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GBM Data Tools</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">Jupyter Notebooks</a> &raquo;</li>
        
      <li>Simulations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/notebooks/Simulations.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="Simulations">
<h1>Simulations<a class="headerlink" href="#Simulations" title="Permalink to this headline">¶</a></h1>
<p>So maybe you’re not satisfied with looking at real data; you want to make your own. The <code class="docutils literal notranslate"><span class="pre">gbm.simulate</span></code> module contains some classes and functions that allow you to simulate GBM data. Let’s take a look at how you would do this.</p>
<hr class="docutils" />
<div class="section" id="Simulate-PHA-Data">
<h2>Simulate PHA Data<a class="headerlink" href="#Simulate-PHA-Data" title="Permalink to this headline">¶</a></h2>
<p>Consider a single spectrum. We don’t really care about the lightcurve, just the spectrum of some particular source. What do you need to simulate what the signal looks like in GBM? For starters, you need a model of what the source spectrum looks like, and you need a detector response. Remember that the response is angular-dependent, so if you try responses with different source-detector angles, the signal will look different. You also want a realistic background model. For the source spectrum, we
have an actual functional model, for the background (currently) we do not. Hmmm.</p>
<p>Our solution here is to phenomenologically model some <em>real</em> background data and use that background model for our simulations. Let’s use the example from the <a class="reference internal" href="PhaExport.html"><span class="doc">PHA Export notebook</span></a>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gbm</span> <span class="kn">import</span> <span class="n">test_data_dir</span>
<span class="kn">from</span> <span class="nn">gbm.data</span> <span class="kn">import</span> <span class="n">TTE</span><span class="p">,</span> <span class="n">RSP</span>
<span class="kn">from</span> <span class="nn">gbm.binning.unbinned</span> <span class="kn">import</span> <span class="n">bin_by_time</span>

<span class="c1"># open a TTE file and response</span>
<span class="n">tte</span> <span class="o">=</span> <span class="n">TTE</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">test_data_dir</span><span class="o">+</span><span class="s1">&#39;/glg_tte_n9_bn090131090_v00.fit&#39;</span><span class="p">)</span>
<span class="n">rsp</span> <span class="o">=</span> <span class="n">RSP</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">test_data_dir</span><span class="o">+</span><span class="s1">&#39;/glg_cspec_n9_bn090131090_v00.rsp2&#39;</span><span class="p">)</span>

<span class="c1"># bin to 1.024 s resolution, reference time is trigger time</span>
<span class="n">phaii</span> <span class="o">=</span> <span class="n">tte</span><span class="o">.</span><span class="n">to_phaii</span><span class="p">(</span><span class="n">bin_by_time</span><span class="p">,</span> <span class="mf">1.024</span><span class="p">,</span> <span class="n">time_ref</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Fit the background:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gbm.background</span> <span class="kn">import</span> <span class="n">BackgroundFitter</span>
<span class="kn">from</span> <span class="nn">gbm.background.binned</span> <span class="kn">import</span> <span class="n">Polynomial</span>

<span class="n">bkgd_times</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">20.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">),</span> <span class="p">(</span><span class="mf">75.0</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">)]</span>
<span class="n">backfitter</span> <span class="o">=</span> <span class="n">BackgroundFitter</span><span class="o">.</span><span class="n">from_phaii</span><span class="p">(</span><span class="n">phaii</span><span class="p">,</span> <span class="n">Polynomial</span><span class="p">,</span> <span class="n">time_ranges</span><span class="o">=</span><span class="n">bkgd_times</span><span class="p">)</span>

<span class="n">backfitter</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">bkgd</span> <span class="o">=</span> <span class="n">backfitter</span><span class="o">.</span><span class="n">interpolate_bins</span><span class="p">(</span><span class="n">phaii</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tstart</span><span class="p">,</span> <span class="n">phaii</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">tstop</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In principle, you can select any part of the background model that you think accurately reflects the background data. Let’s try a selection.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">gbm.plot</span> <span class="kn">import</span> <span class="n">Lightcurve</span><span class="p">,</span> <span class="n">Spectrum</span>

<span class="n">select_time</span> <span class="o">=</span> <span class="p">(</span><span class="mf">150.0</span><span class="p">,</span> <span class="mf">152.0</span><span class="p">)</span>

<span class="c1"># the background model integrated over the source selection time</span>
<span class="n">spec_bkgd</span> <span class="o">=</span> <span class="n">bkgd</span><span class="o">.</span><span class="n">integrate_time</span><span class="p">(</span><span class="o">*</span><span class="n">select_time</span><span class="p">)</span>  <span class="c1"># &lt;-- This is what we will use for our simulations</span>

<span class="c1"># and the data</span>
<span class="n">spec_data</span> <span class="o">=</span> <span class="n">phaii</span><span class="o">.</span><span class="n">to_spectrum</span><span class="p">(</span><span class="n">time_range</span><span class="o">=</span><span class="n">select_time</span><span class="p">)</span>

<span class="c1"># plot the comparison between the background model and the data</span>
<span class="n">specplot</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">spec_data</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="n">spec_bkgd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Simulations_6_0.png" src="../_images/notebooks_Simulations_6_0.png" />
</div>
</div>
<p>As you can see, the background model (red) closely follows the background data (blue), so we can consider this an acceptable background model to use for our simulation. Next, we want to define our source spectrum and exposure:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Band function with amplitude=0.1, Epeak=300 keV, alpha=-1.0, beta=-2.5</span>
<span class="kn">from</span> <span class="nn">gbm.spectra.functions</span> <span class="kn">import</span> <span class="n">Band</span>
<span class="n">band_params</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">300.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">)</span>

<span class="c1"># 2 s exposure</span>
<span class="n">exposure</span> <span class="o">=</span> <span class="mf">2.0</span>
</pre></div>
</div>
</div>
<p>And finally, we need to decide if our background is to be Poisson or Gaussian generated. For GBM, it is usually most appropriate to assume it is Gaussian, so that is what we use here. Now we can create our PHA simulator:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">gbm.simulate</span> <span class="kn">import</span> <span class="n">PhaSimulator</span>
<span class="n">pha_sims</span> <span class="o">=</span> <span class="n">PhaSimulator</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">Band</span><span class="p">(),</span> <span class="n">band_params</span><span class="p">,</span> <span class="n">exposure</span><span class="p">,</span> <span class="n">spec_bkgd</span><span class="p">,</span> <span class="s1">&#39;Gaussian&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Alright, the simulator has been initialized. What now? Well first, let’s look to see how well the simulated background matches our background model:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># make 20 simulations of the background</span>
<span class="n">bkgd_devs</span> <span class="o">=</span> <span class="n">pha_sims</span><span class="o">.</span><span class="n">simulate_background</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>


<span class="c1"># And plot the background model and 20 simulations</span>
<span class="c1"># SpectrumBackground is the plotting class for spectral background models</span>
<span class="kn">from</span> <span class="nn">gbm.plot.gbmplot</span> <span class="kn">import</span> <span class="n">SpectrumBackground</span>

<span class="n">specplot</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="c1"># background from each simulation</span>
<span class="n">sim_bkgds</span> <span class="o">=</span> <span class="p">[</span><span class="n">SpectrumBackground</span><span class="p">(</span><span class="n">bkgd_dev</span><span class="p">,</span> <span class="n">specplot</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span> <span class="k">for</span> <span class="n">bkgd_dev</span> <span class="ow">in</span> <span class="n">bkgd_devs</span><span class="p">]</span>
<span class="c1"># our original background model</span>
<span class="n">specplot</span><span class="o">.</span><span class="n">set_background</span><span class="p">(</span><span class="n">spec_bkgd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Simulations_12_0.png" src="../_images/notebooks_Simulations_12_0.png" />
</div>
</div>
<p>Looks good. Now let’s simulate the background+source, which is essentially what we observe in reality, and compare to just the simulated background:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># 20 source+background simulations</span>
<span class="n">summed_devs</span> <span class="o">=</span> <span class="n">pha_sims</span><span class="o">.</span><span class="n">simulate_sum</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Histo is the plotting class for observed lightcurves or count spectra</span>
<span class="kn">from</span> <span class="nn">gbm.plot.gbmplot</span> <span class="kn">import</span> <span class="n">Histo</span>

<span class="n">specplot</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">()</span>
<span class="c1"># background from each simulation</span>
<span class="n">sim_bkgds</span> <span class="o">=</span> <span class="p">[</span><span class="n">SpectrumBackground</span><span class="p">(</span><span class="n">bkgd_dev</span><span class="p">,</span> <span class="n">specplot</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span> <span class="k">for</span> <span class="n">bkgd_dev</span> <span class="ow">in</span> <span class="n">bkgd_devs</span><span class="p">]</span>
<span class="c1"># the summed &quot;observed&quot; data from each simulation</span>
<span class="n">sim_signals</span> <span class="o">=</span> <span class="p">[</span><span class="n">Histo</span><span class="p">(</span><span class="n">summed_dev</span><span class="p">,</span> <span class="n">specplot</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;midnightblue&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span> <span class="k">for</span> <span class="n">summed_dev</span> <span class="ow">in</span> <span class="n">summed_devs</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Simulations_14_0.png" src="../_images/notebooks_Simulations_14_0.png" />
</div>
</div>
<p>Fantastic! Another cool thing you can do is generate fully formed <code class="docutils literal notranslate"><span class="pre">BAK</span></code> and <code class="docutils literal notranslate"><span class="pre">PHA</span></code> objects from the simulations:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># create 5 simulated BAK and PHA objects</span>
<span class="n">baks</span> <span class="o">=</span> <span class="n">pha_sims</span><span class="o">.</span><span class="n">to_bak</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">phas</span> <span class="o">=</span> <span class="n">pha_sims</span><span class="o">.</span><span class="n">to_pha</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">baks</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">phas</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&lt;gbm.data.pha.BAK object at 0x12996d7d0&gt;, &lt;gbm.data.pha.BAK object at 0x1299a3810&gt;, &lt;gbm.data.pha.BAK object at 0x1299c8f50&gt;, &lt;gbm.data.pha.BAK object at 0x1299e38d0&gt;, &lt;gbm.data.pha.BAK object at 0x1299f2310&gt;]
[&lt;gbm.data.pha.PHA object at 0x129a05ed0&gt;, &lt;gbm.data.pha.PHA object at 0x129a0e4d0&gt;, &lt;gbm.data.pha.PHA object at 0x129a18610&gt;, &lt;gbm.data.pha.PHA object at 0x129a2d610&gt;, &lt;gbm.data.pha.PHA object at 0x129a42090&gt;]
</pre></div></div>
</div>
<p>Those objects can then be written to disk if desired by the corresponding <code class="docutils literal notranslate"><span class="pre">.write()</span></code> methods. You can also create (and write) a <code class="docutils literal notranslate"><span class="pre">PHAII</span></code> object by concatenating all of your simulations into a single time-series:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># concatenate 10 simulations into a single PHAII object</span>
<span class="n">pha_sims</span><span class="o">.</span><span class="n">to_phaii</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;gbm.data.phaii.PHAII at 0x129a58fd0&gt;
</pre></div></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Simulate-TTE-Data">
<h2>Simulate TTE Data<a class="headerlink" href="#Simulate-TTE-Data" title="Permalink to this headline">¶</a></h2>
<p>Simulating PHA data isn’t interesting enough, you say? Well, good news: you can also simulate TTE data. Specifically, you can simulate a lightcurve with the full spectral resolution of the GBM detector response. To do that, we’ll use the TTE simulators and some time profile functions:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># source and background simulators</span>
<span class="kn">from</span> <span class="nn">gbm.simulate</span> <span class="kn">import</span> <span class="n">TteSourceSimulator</span><span class="p">,</span> <span class="n">TteBackgroundSimulator</span>

<span class="c1"># A tophat (rectangular) pulse and a constant background</span>
<span class="kn">from</span> <span class="nn">gbm.simulate.profiles</span> <span class="kn">import</span> <span class="n">tophat</span><span class="p">,</span> <span class="n">constant</span>
</pre></div>
</div>
</div>
<p>First, we simulate the source spectrum and time profile:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># amplitude, start and stop times of the tophat pulse</span>
<span class="n">tophat_params</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>

<span class="c1"># initialize simulator with the spectral model and time profile</span>
<span class="n">tte_sim</span> <span class="o">=</span> <span class="n">TteSourceSimulator</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">Band</span><span class="p">(),</span> <span class="n">band_params</span><span class="p">,</span> <span class="n">tophat</span><span class="p">,</span> <span class="n">tophat_params</span><span class="p">)</span>

<span class="c1"># time range over which to simulate source</span>
<span class="n">tte_src</span> <span class="o">=</span> <span class="n">tte_sim</span><span class="o">.</span><span class="n">to_tte</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>And then we simulate the background:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># use our background model spectrum and scale to 200% of the background amplitude</span>
<span class="n">constant_params</span> <span class="o">=</span> <span class="p">(</span><span class="mf">2.0</span><span class="p">,)</span>
<span class="n">tte_sim</span> <span class="o">=</span> <span class="n">TteBackgroundSimulator</span><span class="p">(</span><span class="n">spec_bkgd</span><span class="p">,</span> <span class="s1">&#39;Gaussian&#39;</span><span class="p">,</span> <span class="n">constant</span><span class="p">,</span> <span class="n">constant_params</span><span class="p">)</span>

<span class="c1"># time range over which to simulate background</span>
<span class="n">tte_bkgd</span> <span class="o">=</span> <span class="n">tte_sim</span><span class="o">.</span><span class="n">to_tte</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>So now we have simulated data for the source and the background. We want source+background:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># merge the background and source</span>
<span class="n">tte_total</span> <span class="o">=</span> <span class="n">TTE</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">tte_bkgd</span><span class="p">,</span> <span class="n">tte_src</span><span class="p">])</span>

<span class="c1"># bin to 64 ms resolution so we can make a lightcurve plot</span>
<span class="n">phaii</span> <span class="o">=</span> <span class="n">tte_total</span><span class="o">.</span><span class="n">to_phaii</span><span class="p">(</span><span class="n">bin_by_time</span><span class="p">,</span> <span class="mf">0.064</span><span class="p">)</span>
<span class="n">lcplot</span> <span class="o">=</span> <span class="n">Lightcurve</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">phaii</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">900.0</span><span class="p">)))</span>
<span class="n">lcplot</span><span class="o">.</span><span class="n">errorbars</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Simulations_26_0.png" src="../_images/notebooks_Simulations_26_0.png" />
</div>
</div>
<p>Interesting…but not exactly a realistic looking signal. Let’s try something that looks quite a bit more realistic:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># a Norris pulse shape and a quadratic background</span>
<span class="kn">from</span> <span class="nn">gbm.simulate.profiles</span> <span class="kn">import</span> <span class="n">norris</span><span class="p">,</span> <span class="n">quadratic</span>

<span class="n">norris_params</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">quadratic_params</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">)</span>

<span class="c1"># source simulation</span>
<span class="n">tte_sim</span> <span class="o">=</span> <span class="n">TteSourceSimulator</span><span class="p">(</span><span class="n">rsp</span><span class="p">,</span> <span class="n">Band</span><span class="p">(),</span> <span class="n">band_params</span><span class="p">,</span> <span class="n">norris</span><span class="p">,</span> <span class="n">norris_params</span><span class="p">)</span>
<span class="n">tte_src</span> <span class="o">=</span> <span class="n">tte_sim</span><span class="o">.</span><span class="n">to_tte</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>

<span class="c1"># background simulation</span>
<span class="n">tte_sim</span> <span class="o">=</span> <span class="n">TteBackgroundSimulator</span><span class="p">(</span><span class="n">spec_bkgd</span><span class="p">,</span> <span class="s1">&#39;Gaussian&#39;</span><span class="p">,</span> <span class="n">quadratic</span><span class="p">,</span> <span class="n">quadratic_params</span><span class="p">)</span>
<span class="n">tte_bkgd</span> <span class="o">=</span> <span class="n">tte_sim</span><span class="o">.</span><span class="n">to_tte</span><span class="p">(</span><span class="o">-</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">)</span>

<span class="c1"># merge the background and source</span>
<span class="n">tte_total</span> <span class="o">=</span> <span class="n">TTE</span><span class="o">.</span><span class="n">merge</span><span class="p">([</span><span class="n">tte_bkgd</span><span class="p">,</span> <span class="n">tte_src</span><span class="p">])</span>

<span class="c1"># bin to 64 ms resolution so we can make a lightcurve plot</span>
<span class="n">phaii</span> <span class="o">=</span> <span class="n">tte_total</span><span class="o">.</span><span class="n">to_phaii</span><span class="p">(</span><span class="n">bin_by_time</span><span class="p">,</span> <span class="mf">0.064</span><span class="p">)</span>
<span class="n">lcplot</span> <span class="o">=</span> <span class="n">Lightcurve</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">phaii</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">energy_range</span><span class="o">=</span><span class="p">(</span><span class="mf">8.0</span><span class="p">,</span> <span class="mf">900.0</span><span class="p">)))</span>
<span class="n">lcplot</span><span class="o">.</span><span class="n">errorbars</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_Simulations_28_0.png" src="../_images/notebooks_Simulations_28_0.png" />
</div>
</div>
<p>Voila!</p>
<p>There are lots of things you can do once you create the simulations; you can essentially treat them like data. If you’re interested in a variety of other aspects of the GBM Data Tools, and a deeper dive under the hood, please <a class="reference internal" href="DataPrimitives.html"><span class="doc">continue on!</span></a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="DataPrimitives.html" class="btn btn-neutral float-right" title="Introduction to the Data Primitives" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="ScatFiles.html" class="btn btn-neutral float-left" title="GBM Spectral Catalog Files" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright .

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>